<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>~Enigma~   文以載道，寧靜以致遠 (學習與閱讀)</title><link>http://sophAi.github.com/Enigma</link><description>It's a journey toward happiness</description><lastBuildDate>Fri, 12 Jul 2013 15:32:04 GMT</lastBuildDate><generator>nikola</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>探討網路照片的奧秘</title><link>http://sophAi.github.com/Enigma/posts/M43/sharpen.html</link><description>&lt;!-- title: 探討網路照片的奧秘 --&gt;
&lt;!-- slug: sharpen --&gt;
&lt;!-- date: 20130712 15:17:08 --&gt;
&lt;!-- tags: 學習與閱讀 --&gt;
&lt;!-- link: --&gt;
&lt;!-- description: Created at 20130620 20:38:34 --&gt;
&lt;!-- ===================================Metadata↑================================================ --&gt;
&lt;!-- ● 記得加上tags: 人生，狗狗，程式，生活紀錄，英文，閱讀，教養，科學，mathjax --&gt;
&lt;!-- ● 記得加上slug，會以slug內容作為檔名(html檔)，同時將對應的內容放到對應的標籤裡。 --&gt;
&lt;!-- ===================================文章起始↓================================================ --&gt;
&lt;!-- &lt;body&gt; --&gt;
&lt;p&gt;我們先來看看下面四張長與寬最大640px的圖，其來源都是同一張相片:&lt;/p&gt;
&lt;div class="figure align-center"&gt;
&lt;a class="reference external image-reference" href="/../arch_2013/file_2013/M43/sharpen/640_P1370103.jpg"&gt;&lt;img alt="../../../arch_2013/file_2013/M43/sharpen/640_P1370103.jpg" src="/../arch_2013/file_2013/M43/sharpen/640_P1370103.jpg"&gt;&lt;/a&gt;
&lt;p class="caption"&gt;原始圖檔縮小至640px，上傳至github。&lt;/p&gt;
&lt;/div&gt;
&lt;div class="figure align-center"&gt;
&lt;a class="reference external image-reference" href="https://lh4.googleusercontent.com/-P554w0SP0GE/Ud-TC2G5TSI/AAAAAAAA-0g/8EPfB0i7z24/s640/P1370103_4429113-08.jpg"&gt;&lt;img alt="https://lh4.googleusercontent.com/-P554w0SP0GE/Ud-TC2G5TSI/AAAAAAAA-0g/8EPfB0i7z24/s640/P1370103_4429113-08.jpg" src="https://lh4.googleusercontent.com/-P554w0SP0GE/Ud-TC2G5TSI/AAAAAAAA-0g/8EPfB0i7z24/s640/P1370103_4429113-08.jpg" style="width: 640px;"&gt;&lt;/a&gt;
&lt;p class="caption"&gt;原始圖檔上傳至google相簿，以640px呈現。&lt;/p&gt;
&lt;/div&gt;
&lt;div class="figure align-center"&gt;
&lt;a class="reference external image-reference" href="https://farm6.staticflickr.com/5504/9093131904_94d84757d5_c.jpg"&gt;&lt;img alt="https://farm6.staticflickr.com/5504/9093131904_94d84757d5_c.jpg" src="https://farm6.staticflickr.com/5504/9093131904_94d84757d5_c.jpg" style="width: 640px;"&gt;&lt;/a&gt;
&lt;p class="caption"&gt;原始圖檔上傳至Flickr相簿，以640px呈現。&lt;/p&gt;
&lt;/div&gt;
&lt;div class="figure align-center"&gt;
&lt;a class="reference external image-reference" href="/../arch_2013/file_2013/M43/sharpen/640_P1370103_sharpen.jpg"&gt;&lt;img alt="../../../arch_2013/file_2013/M43/sharpen/640_P1370103_sharpen.jpg" src="/../arch_2013/file_2013/M43/sharpen/640_P1370103_sharpen.jpg"&gt;&lt;/a&gt;
&lt;p class="caption"&gt;Imagemagick 縮圖至640px並銳化，上傳到github。&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;接著來看800px解析度下的結果:&lt;/p&gt;
&lt;div class="figure align-center"&gt;
&lt;a class="reference external image-reference" href="/../arch_2013/file_2013/M43/sharpen/800_P1370032.jpg"&gt;&lt;img alt="../../../arch_2013/file_2013/M43/sharpen/800_P1370032.jpg" src="/../arch_2013/file_2013/M43/sharpen/800_P1370032.jpg"&gt;&lt;/a&gt;
&lt;p class="caption"&gt;原始圖檔直接縮小至800px，上傳至github。&lt;/p&gt;
&lt;/div&gt;
&lt;div class="figure align-center"&gt;
&lt;a class="reference external image-reference" href="https://lh5.googleusercontent.com/-Fh9yCjBNUF0/Ud-pSM5JRnI/AAAAAAAA-0s/WSAKPSTyzgY/s800/P1370032_4429113-08.jpg"&gt;&lt;img alt="https://lh5.googleusercontent.com/-Fh9yCjBNUF0/Ud-pSM5JRnI/AAAAAAAA-0s/WSAKPSTyzgY/s800/P1370032_4429113-08.jpg" src="https://lh5.googleusercontent.com/-Fh9yCjBNUF0/Ud-pSM5JRnI/AAAAAAAA-0s/WSAKPSTyzgY/s800/P1370032_4429113-08.jpg" style="width: 800px;"&gt;&lt;/a&gt;
&lt;p class="caption"&gt;原始圖檔上傳至google相簿，以800px呈現。&lt;/p&gt;
&lt;/div&gt;
&lt;div class="figure align-center"&gt;
&lt;a class="reference external image-reference" href="https://farm8.staticflickr.com/7402/9093134142_58ea69c6b4_c.jpg"&gt;&lt;img alt="https://farm8.staticflickr.com/7402/9093134142_58ea69c6b4_c.jpg" src="https://farm8.staticflickr.com/7402/9093134142_58ea69c6b4_c.jpg" style="width: 800px;"&gt;&lt;/a&gt;
&lt;p class="caption"&gt;原始圖檔上傳至Flickr相簿，以800px呈現。&lt;/p&gt;
&lt;/div&gt;
&lt;div class="figure align-center"&gt;
&lt;a class="reference external image-reference" href="/../arch_2013/file_2013/M43/sharpen/800_P1370032_sharpen.jpg"&gt;&lt;img alt="../../../arch_2013/file_2013/M43/sharpen/800_P1370032_sharpen.jpg" src="/../arch_2013/file_2013/M43/sharpen/800_P1370032_sharpen.jpg"&gt;&lt;/a&gt;
&lt;p class="caption"&gt;imagemagick 縮圖至800px並銳化，上傳至github。&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;imagemagick的參數如下:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
convert 原始圖檔.jpg -colorspace RGB -filter LanczosSharp -distort Resize 800x800 -unsharp 1x0.55+1.5+0.002 -colorspace sRGB -border 10 -quality 100 縮圖檔名.jpg
&lt;/pre&gt;
&lt;p&gt;縮圖最重要的兩個環節，就是避免鋸齒化以及像素捨去(down sample)所產生的模糊化，這兩者無論是對於靜態影像或是動態影像都是非常重要的，對於去鋸齒化，我們參考&lt;a class="reference external" href="http://www.imagemagick.org/Usage/filter/nicolas/"&gt;Nicolas Robidoux&lt;/a&gt;&lt;a class="footnote-reference" href="/posts/M43/sharpen.html#id5" id="id1"&gt;[1]&lt;/a&gt;教授所建議的參數，使用distort Resize搭配-filter LanczosSharp，LanczosSharp其實是屬於Windowed SincFast演算法，可以用Verbose模式將細部的設定列出，例如在命令列下達:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
convert null: -filter LanczosSharp -define filter:verbose=1 -resize 2 null: | grep '^#'
&lt;/pre&gt;
&lt;p&gt;則會顯示:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# Resize Filter (for graphing)
#
# filter = SincFast
# window = SincFast
# support = 3
# win-support = 3
# scale_blur = 0.981251
# practical_support = 2.94375
&lt;/pre&gt;
&lt;p&gt;這就是LanczosSharp的細部參數。所謂的縮圖，其實跟tenser transformation有關，因為一張圖其實就是以一個龐大的矩陣儲存影像資訊，有關SincFast演算法可以參考&lt;a class="reference external" href="http://www.imagemagick.org/Usage/filter/#gaussian_other"&gt;Resampling Filters&lt;/a&gt; &lt;a class="footnote-reference" href="/posts/M43/sharpen.html#id6" id="id2"&gt;[2]&lt;/a&gt;這方面的資訊。&lt;/p&gt;
&lt;p&gt;而對於銳化這部份，效果比較好的是使用Gaussian Mask，類似的方式如&lt;a class="reference external" href="http://gimpguru.org/Tutorials/SmartSharpening2/"&gt;Smart Sharpen&lt;/a&gt; &lt;a class="footnote-reference" href="/posts/M43/sharpen.html#id7" id="id3"&gt;[3]&lt;/a&gt;，使用Photoshop或GIMP即可針對畫面線條的邊緣進行銳化，而跳過色階變化平滑的區域(例如膚色，或是天空)，這樣一來，就不會一併將雜訊銳化而造成不自然的雜點，而imagemagick使用-unsharp這個參數，也能達到類似的效果，更省去了滑鼠點來點去的繁瑣步驟，很適合用來一次處理大量的圖片。-unsharp參數在&lt;a class="reference external" href="http://redskiesatnight.com/2005/04/06/sharpening-using-image-magick/"&gt;Eric Jeschke&lt;/a&gt; &lt;a class="footnote-reference" href="/posts/M43/sharpen.html#id8" id="id4"&gt;[4]&lt;/a&gt; 的文章裡有很詳細的解說，以我們所使用的銳化參數為例:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
-unsharp 1x0.55+1.5+0.002
&lt;/pre&gt;
&lt;p&gt;所使用的四個數字分別是Gaussian Mask的Radius(銳化時，每個像素周圍列入銳化計算的像素範圍)、Sigma(Gaussian遮罩的半高寬，或是Standard Deviation)、Amount(將遮罩疊回原圖的比例)、以及Threshold(像素間對比差異要高於這個值才會列入銳化的計算)。在Eric的文章裡提到很多Radius與Sigma的計算方式，不過我們這邊取的參數，是筆者經過多次嘗試，而得到與Flickr縮圖銳化最接近的參數，同時，銳化與縮圖也有先後次序，筆者建議先進行縮圖在銳化，因為要做到與Flickr相簿同樣的效果，先銳化時，必須要大大加強銳化的強度，容易讓照片產生不自然的顆粒，同時縮圖的速度也會比較慢。&lt;/p&gt;
&lt;p&gt;看到這裡，我們對網路上所廣為流傳的許多資訊應該會更有概念，例如:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;&lt;li&gt;1:1檢視照片的必要性?為什麼非縮圖不可?&lt;/li&gt;
&lt;li&gt;相機所提供的高畫素，目的為何?&lt;/li&gt;
&lt;li&gt;鏡頭的銳利度(MTF-50)，片幅的大小(135, APS, 4/3,...)，感光元件(Bayer, Foveon X3)的種類等差異，在縮圖的情況下是否還能夠呈現?&lt;/li&gt;
&lt;li&gt;數位相機的總畫素平均遠高於Full HD(1080p)的解析度，因此錄影的影像品質會不會受到縮圖(down sample)方式極大的影響。&lt;/li&gt;
&lt;li&gt;您有沒有在網路上見過高檔，大片幅相機拍攝的的數位照片，清晰度竟然比一般DC還差?&lt;/li&gt;
&lt;li&gt;您有沒有遇到過片幅比較大的數位相機，其錄影畫清晰度竟然比片幅小的畫質還差?&lt;/li&gt;
&lt;li&gt;數位照片是否都是後製過的?&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;這些問題，筆者先不作進一步說明，留給各位思考。&lt;/p&gt;
&lt;p&gt;接著我們將示範如何撰寫python程式來利用imagemagick實現自動化的批次縮圖銳化，我們的目的是將一個目錄下的所有jpg檔予以縮圖並銳化，然後自動生成包含圖片連結的Restructured TEXT的文章範例，換句話說，在網路文章裡插入圖片，不再需要繁複的上傳照片與拷貝連結等手續，僅需要將要包含的圖片按照順序集中在一個資料夾裡，執行程式就可以自動生成文章，照片也會依照順序排列，剩下的工作就僅是補上文字而已。同時，我們也不用擔心只有經過Flickr相簿處理過的縮圖照片才有最好的品質，在任何網站裡，我們都可以呈現出品質良好的縮圖照片。&lt;/p&gt;
&lt;!-- &lt;/body&gt; --&gt;
&lt;!-- &lt;url&gt; --&gt;
&lt;!-- &lt;/url&gt; --&gt;
&lt;!-- &lt;footnote&gt; --&gt;
&lt;table class="docutils footnote" frame="void" id="id5" rules="none"&gt;&lt;colgroup&gt;&lt;col class="label"&gt;&lt;col&gt;&lt;/colgroup&gt;&lt;tbody valign="top"&gt;&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="/posts/M43/sharpen.html#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a class="reference external" href="http://www.imagemagick.org/Usage/filter/nicolas/"&gt;http://www.imagemagick.org/Usage/filter/nicolas/&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;table class="docutils footnote" frame="void" id="id6" rules="none"&gt;&lt;colgroup&gt;&lt;col class="label"&gt;&lt;col&gt;&lt;/colgroup&gt;&lt;tbody valign="top"&gt;&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="/posts/M43/sharpen.html#id2"&gt;[2]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a class="reference external" href="http://www.imagemagick.org/Usage/filter/#gaussian_other"&gt;http://www.imagemagick.org/Usage/filter/#gaussian_other&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;table class="docutils footnote" frame="void" id="id7" rules="none"&gt;&lt;colgroup&gt;&lt;col class="label"&gt;&lt;col&gt;&lt;/colgroup&gt;&lt;tbody valign="top"&gt;&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="/posts/M43/sharpen.html#id3"&gt;[3]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a class="reference external" href="http://gimpguru.org/Tutorials/SmartSharpening2/"&gt;http://gimpguru.org/Tutorials/SmartSharpening2/&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;table class="docutils footnote" frame="void" id="id8" rules="none"&gt;&lt;colgroup&gt;&lt;col class="label"&gt;&lt;col&gt;&lt;/colgroup&gt;&lt;tbody valign="top"&gt;&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="/posts/M43/sharpen.html#id4"&gt;[4]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a class="reference external" href="http://redskiesatnight.com/2005/04/06/sharpening-using-image-magick/"&gt;http://redskiesatnight.com/2005/04/06/sharpening-using-image-magick/&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;!-- &lt;/footnote&gt; --&gt;&lt;!-- &lt;citation&gt; --&gt;&lt;!-- &lt;/citation&gt; --&gt;&lt;!-- ===================================文章結束↑/語法備忘錄↓==================================== --&gt;&lt;!-- ● 格式1 ― 粗體(**字串**)  斜體(*字串*)  大字(\ :big:`字串`\ )  小字(\ :small:`字串`\ ) --&gt;&lt;!-- ● 格式2 ― 上標(\ :sup:`字串`\ )  下標(\ :sub:`字串`\ )  ``去除格式字串`` --&gt;&lt;!-- ● 項目 ― #. (換行) #.　或是a. (換行) #. 或是I(i). 換行 #.  或是*. -. +. 子項目前面要多空一格 --&gt;&lt;!-- ● 插入teaser分頁 ― .. TEASER_END --&gt;&lt;!-- ● 插入latex數學 ― 段落裡加入\ :math:`latex數學`\ 語法，或獨立行.. math:: (換行) Latex數學 --&gt;&lt;!-- ● 插入figure ― .. figure:: 路徑(換行):width: 320(換行):align: center(換行):target: 路徑 --&gt;&lt;!-- ● 插入slides ― .. slides:: (空一行) 圖擋路徑1 (換行) 圖擋路徑2 ... (空一行) --&gt;&lt;!-- ● 插入youtube ― ..youtube:: 影片的hash string --&gt;&lt;!-- ● 插入url ― 段落裡加入\ `連結字串`_\  URL區加上對應的.. _連結字串: 網址 (儘量用這個) --&gt;&lt;!-- ● 插入直接url ― \ `連結字串` &lt;網址或路徑&gt;`_ \    (包含&lt; &gt;) --&gt;&lt;!-- ● 插入footnote ― 段落裡加入\ [#]_\ 註腳    註腳區加上對應順序排列.. [#] 註腳內容 --&gt;&lt;!-- ● 插入citation ― 段落裡加入\ [引用字串]_\ 名字字串  引用區加上.. [引用字串] 引用內容 --&gt;&lt;!-- ● 插入sidebar ― ..sidebar:: (空一行) 內容 --&gt;&lt;!-- ● 插入contents ― ..contents:: (換行) :depth: 目錄深入第幾層 --&gt;&lt;!-- ● 插入原始文字區塊 ― 在段落尾端使用:: (空一行) 內容 (空一行) --&gt;&lt;!-- ● 插入本機的程式碼 ― ..listing:: 放在listings目錄裡的程式碼檔名 (讓原始碼跟隨網站) --&gt;&lt;!-- ● 插入特定原始碼 ― ..code::python (或cpp) (換行) :number-lines: (把程式碼行數列出) --&gt;&lt;!-- ● 插入gist ― ..gist:: gist編號 (要先到github的gist裡貼上程式代碼) --&gt;&lt;!-- ============================================================================================ --&gt;</description><category>學習與閱讀</category><guid>http://sophAi.github.com/Enigma/posts/M43/sharpen.html</guid><pubDate>Fri, 12 Jul 2013 07:17:08 GMT</pubDate></item></channel></rss>